var HD=function(){"use strict";function y(){var a=t("accessToken");return a?"Bearer "+window.btoa(a):null}function z(a,b,c,d){f({type:"GET",url:a,authzheader:void 0},function(a){200===a.status||201===a.status?b(a):c(a)},function(a){var b=a;try{b=JSON.parse(a.response),b.status=a.status}catch(d){}c(b)},d())}function A(a,b,c,e){var g,h;g=d("/file"),h=p(a,t("accessToken")),h.data&&(g+="?"+h.data),f({type:"GET",url:g,authzheader:h.oAuthHeader,responseType:"blob"},function(a){200===a.status?b(a.response):c(a)},function(a){c(a)},function(a){e(a)})}function B(a,b,c,e){var g,h;g=d("/file/thumbnail"),h=p(a,t("accessToken")),h.data&&(g+="?"+h.data),f({type:"GET",url:g,authzheader:h.oAuthHeader,responseType:"blob"},function(a){200===a.status?b(a.response):c(a)},function(a){c(a)},function(a){e(a)})}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,a="0.0.1",x={accessToken:null,appId:null,appSecret:null,userScope:null,grantScope:null,type:null,redirectUrl:null,language:null,userName:null,accountId:null,refreshToken:null,apiUrl:null};return f=function(a,b,c,d){var f,g,h,i,j,k,e=v();if(e.onreadystatechange=function(){e._canceled||(4===e.readyState?(e.status>=200&&e.status<300?b(e):c(e),e.onreadystatechange=function(){}):d&&d(e))},e.open(a.type||"GET",a.url,!0,a.user,a.password),e.responseType=a.responseType||"",i={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","If-Modified-Since":"Mon, 27 Mar 1972 00:00:00 GMT"},a.headers=a.headers||i,a.authzheader&&(a.headers.Authorization=a.authzheader),Object.keys(a.headers||{}).forEach(function(b){e.setRequestHeader(b,a.headers[b])}),j="",a.data)for(f in a.data)if(a.data.hasOwnProperty(f))if("array"===f)for(k=a.data[f],g=0;g<k.length;g++){j.length>0&&(j+="&");for(h in k[g])k[g].hasOwnProperty(h)&&(j+=h+"="+encodeURIComponent(k[g][h]))}else j.length>0&&(j+="&"),j+=f+"="+encodeURIComponent(a.data[f]);e.send(j)},g=function(a,b){k("/user/me",null,function(b){t({userName:b.alias}),t({accountId:b.account}),a(b)},function(a){b(a)},function(){})},h=function(a,b,c){var d={refresh_token:a||t("refreshToken"),grant_type:t("type"),client_id:t("appId"),client_secret:t("appSecret")};l("POST","/token",d,function(a){t({accessToken:a.access_token}),t({userName:a.alias}),b(a)},function(a){c(a)},function(){})},q=function(a,b,c){var d={code:a,grant_type:"authorization_code",client_id:t("appId"),client_secret:t("appSecret")};l("POST","/token",d,function(a){t({refreshToken:a.refresh_token}),t({accessToken:a.access_token}),g(function(a){b(a)},function(a){c(a)})},function(a){c(a)},function(){})},j=function(){t({accessToken:void 0}),t({userName:void 0}),t({accountId:void 0}),t({userScope:void 0}),t({refreshToken:void 0})},b=function(){return e()+"/authorize?response_type=code"},e=function(){return"https://www.hidrive.strato.com/oauth2"},w=function(){return"https://api.hidrive.strato.com/2.1"},c=function(){return void 0!==t("accessToken")},u=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},t=function(a){var b;if(!a)return x;if("[object String]"===Object.prototype.toString.call(a))return u(x,a)?x[a]:null;for(b in x)x.hasOwnProperty(b)&&u(x,b)&&u(a,b)&&(x[b]=a[b])},d=function(a){var b=w();return("/token"===a.substr(0,"/token".length)||"/revoke"===a.substr(0,"/revoke".length))&&(b=e()),b+=a},i=function(){var a={token:t("refreshToken"),type:"refresh",client_id:t("appId"),client_secret:t("appSecret")};l("POST","/revoke",a,function(){},function(){},function(){}),j()},m=function(a,b,c,d,e){return l("POST",a,b,c,d,e)},n=function(a,b,c,d,e){return l("PUT",a,b,c,d,e)},o=function(a,b,c,d,e){return l("DELETE",a,b,c,d,e)},p=function(a,b){var d,e,f,g,c={};if(a)for(d in a)a.hasOwnProperty(d)&&(c[d]=encodeURIComponent(a[d]));f="",g="";for(e in c)c.hasOwnProperty(e)&&(g&&(g+="&"),g+=e+"="+c[e]);return b&&(f+="Bearer "+window.btoa(b)),{oAuthHeader:f,data:g}},k=function(a,b,c,e,g){var i,j,k;i=d(a),j=p(b,t("accessToken")),j.data&&(i+="?"+j.data),k={type:"GET",url:i,authzheader:y()},f(k,function(a){if(200===a.status||201===a.status){var b=a.responseText;try{b=JSON.parse(b)}catch(d){}finally{c(b)}}else 204===a.status?c(a):e(a)},function(g){var k=g.responseText;try{k=JSON.parse(k),k.status=g.status}catch(l){}401===g.status?h(null,function(){i=d(a),j=p(b,t("accessToken")),j.data&&(i+="?"+j.data),f({type:"GET",url:i,authzheader:j.oAuthHeader},function(a){var b=a.responseText;if(200===a.status||201===a.status)try{b=JSON.parse(b)}catch(d){}finally{c(b)}else e(b)},function(a){e(a)})},function(a){e(a)}):e(k)},g())},l=function(a,b,c,e,g,i){var j,k;j=d(b),k=p(c,t("accessToken")),f({type:a,url:j,authzheader:y(),data:c},function(a){if(200===a.status||201===a.status){var b=a.responseText;try{b=JSON.parse(b)}catch(c){}finally{e(b)}}else 204===a.status?e(a):g(a)},function(i){var l=i.responseText;try{l=JSON.parse(l),l.status=i.status}catch(m){}401===i.status?h(null,function(){j=d(b),k=p(c,t("accessToken")),k.data&&(j+="?"+k.data),f({type:a,url:j,authzheader:k.oAuthHeader},function(a){if(200===a.status||201===a.status){var b=a.responseText;try{b=JSON.parse(b)}catch(c){}finally{e(b)}}else g(i)},function(a){g(a)})},function(a){g(a)}):g(l)},i())},s=function(a){var c,d,b={},e="";if(a)for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);for(d in b)b.hasOwnProperty(d)&&(e&&(e+="&"),e+=d+"="+b[d]);return e},r=function(a){var b,c;return b=HD.getFullUrl("/file"),c=s(a),c&&(b+="?"+c),b},v=function(){try{return new XMLHttpRequest}catch(a){throw new Error("Browser is not CORS capable")}},{options:t,getLoginUrl:b,getApiUrl:w,getOAuthUrl:e,version:a,isAuthorized:c,get:k,getStatic:z,logout:i,post:m,put:n,"delete":o,getAuthorizationHeader:y,refreshAccessToken:h,getFile:A,getThumbnail:B,getRefreshToken:q,sessionClear:j,getFullUrl:d,getFileTransactionUrl:r}}(),HiDriveApi=function(){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,a=!1;return h=function(){return new WinJS.Promise(function(b,c,d){var e=new Windows.Foundation.Uri(HD.getLoginUrl()+"&client_id="+HD.options("appId")+"&scope="+HD.options("grantScope")+"&lang="+HD.options("language")),f=new Windows.Foundation.Uri(HD.options("redirectUrl"));a=!0,Windows.Security.Authentication.Web.WebAuthenticationBroker.authenticateAsync(Windows.Security.Authentication.Web.WebAuthenticationOptions.none,e,f).done(function(d){if(d.responseStatus===Windows.Security.Authentication.Web.WebAuthenticationStatus.errorHttp||d.responseStatus===Windows.Security.Authentication.Web.WebAuthenticationStatus.userCancel)a=!1,c&&c(d.responseErrorDetail);else if(d.responseData&&void 0!==d.responseData&&""!==d.responseData){var e=g(d.responseData);b(e)}else a=!1,c&&c(d)},c,d)})},g=function(a){var b={permission:"rw",level:"admin"};if(!a)return b;a.indexOf("?")>-1&&(a=a.substr(a.indexOf("?")+1));for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if("scope"==e[0]){var f=e[1].split(",");b.permission=f[0],b.level=f[1]}else b[e[0]]=e[1]}return b},i=function(){return new WinJS.Promise(function(b,c,d){a||(HD.options("refreshToken")?HD.refreshAccessToken(t("refreshToken"),function(a){b(a)},function(){l(b,c,d)},d):l(b,c,d))})},l=function(c,d,e){h().done(function(f){"rw"==f.permission?HD.getRefreshToken(f.code,function(b){a=!1,HD.options({userScope:f.level}),c(b)},function(a){b(),d(a)},e):(b(),d({error:"invalid permission"}))},function(a){b(),d(a)})},b=function(){HD.sessionClear(),a=!1},d=function(a,b){return new WinJS.Promise(function(c,d,e){HD.post(a,b,c,d,e)})},e=function(a,b){return new WinJS.Promise(function(c,d,e){HD.put(a,b,c,d,e)})},c=function(a,b){return new WinJS.Promise(function(c,d,e){HD.delete(a,b,c,d,e)})},f=function(a,b){return new WinJS.Promise(function(c,d,e){HD.get(a,b,c,d,e)})},j=function(a){return new WinJS.Promise(function(b,c,d){HD.getStatic(a,b,c,d)})},k=function(){HD.logout()},q=function(){return HD.getAuthorizationHeader()},m=function(a){return new WinJS.Promise(function(b,c){HD.refreshAccessToken(a,b,c)})},n=function(a){return new WinJS.Promise(function(b,c,d){HD.getFile(a,b,c,d)})},o=function(a){return new WinJS.Promise(function(b,c,d){HD.getThumbnail(a,b,c,d)})},p=function(a){return HD.getFileTransactionUrl(a)},r=function(a){var b=new Windows.Networking.BackgroundTransfer.BackgroundUploader;b.setRequestHeader("Authorization",q());var c={dir:encodeURIComponent(a.path),name:encodeURIComponent(a.file_name)};a.on_exist&&(c.on_exist=a.on_exist);var d=p(c),e=null;try{e=new Windows.Foundation.Uri(d)}catch(f){return new WinJS.Promise(function(a,b){b()})}var g=b.createUpload(e,a.file_input);return g.startAsync()},s=function(a){var b=new Windows.Networking.BackgroundTransfer.BackgroundDownloader;b.setRequestHeader("Authorization",q());var c={path:a.path},d=p(c),e=null;try{e=new Windows.Foundation.Uri(d)}catch(f){return new WinJS.Promise(function(a,b){b()})}var g=b.createDownload(e,a.file_output);return g.startAsync()},t=function(a){return HD.options(a)},u=function(){HD.sessionClear()},{get:f,getStatic:j,webAuth:i,logout:k,post:d,put:e,"delete":c,getAuthorizationHeader:q,refreshAccessToken:m,getFile:n,getThumbnail:o,getFileTransactionUrl:p,backgroundDownload:s,backgroundUpload:r,options:t,sessionClear:u}}();